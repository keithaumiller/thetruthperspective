<?php

/**
 * @file
 * Twitter Automation module for The Truth Perspective.
 * 
 * Provides automated Twitter posting functionality with configurable scheduling,
 * content generation from analytics data, and manual posting capabilities.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function twitter_automation_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.twitter_automation':
      return '<p>' . t('The Twitter Automation module enables automated posting of analytics insights and news summaries to Twitter twice daily. Configure your Twitter API credentials and posting schedule in the module settings.') . '</p>';
  }
}

/**
 * Implements hook_cron().
 * 
 * Handles automated Twitter posting based on configured schedule.
 */
function twitter_automation_cron() {
  $config = \Drupal::config('twitter_automation.settings');
  
  if (!$config->get('enable_automated_posting')) {
    return;
  }
  
  $scheduler = \Drupal::service('twitter_automation.scheduler');
  $scheduler->processScheduledPosts();
}

/**
 * Implements hook_install().
 * 
 * Sets up default configuration and permissions.
 */
function twitter_automation_install() {
  $config = \Drupal::configFactory()->getEditable('twitter_automation.settings');
  
  // Set default configuration
  $config
    ->set('enable_automated_posting', FALSE)
    ->set('posts_per_day', 2)
    ->set('post_times', ['09:00', '17:00'])
    ->set('content_types', ['analytics_summary', 'trending_topics'])
    ->set('include_metrics', TRUE)
    ->set('include_url', TRUE)
    ->set('hashtags', ['#AI', '#NewsAnalysis', '#MediaBias', '#DataScience'])
    ->save();
    
  \Drupal::logger('twitter_automation')->info('Twitter Automation module installed with default settings.');
}

/**
 * Implements hook_uninstall().
 * 
 * Clean up configuration when module is uninstalled.
 */
function twitter_automation_uninstall() {
  \Drupal::configFactory()->getEditable('twitter_automation.settings')->delete();
  \Drupal::logger('twitter_automation')->info('Twitter Automation module uninstalled and configuration removed.');
}
